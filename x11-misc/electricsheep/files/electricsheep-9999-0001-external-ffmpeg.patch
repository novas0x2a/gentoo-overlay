From 2762de31f0b0b06862ef9dc1ad320e351a705fc2 Mon Sep 17 00:00:00 2001
From: Mike Lundy <mike@fluffypenguin.org>
Date: Mon, 23 Feb 2009 01:02:21 -0700
Subject: [PATCH 1/3] external ffmpeg

---
 Makefile.am  |   16 +++-------------
 configure.in |   10 ++++++----
 2 files changed, 9 insertions(+), 17 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index e4caab8..f717898 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,23 +1,13 @@
 AUTOMAKE_OPTIONS = foreign no-dependencies
 
-ffmpeg = ./ffmpeg
-
-SUBDIRS = ffmpeg
-
-AM_CFLAGS = -DPACKAGE_DATA_DIR=\"$(pkgdatadir)\" -I$(ffmpeg)
-
-electricsheep_LDADD = \
-	$(ffmpeg)/libavformat/libavformat.a \
-	$(ffmpeg)/libavcodec/libavcodec.a \
-	$(ffmpeg)/libavutil/libavutil.a \
-	-lm -lz
+AM_CFLAGS = -DPACKAGE_DATA_DIR=\"$(pkgdatadir)\" @FFMPEG_CFLAGS@ @GLADE_CFLAGS@
 
 bin_PROGRAMS = electricsheep electricsheep-preferences
 
 pkgdata_DATA = electricsheep-wait.avi electricsheep-preferences.glade
 
-electricsheep_preferences_CFLAGS = @libglade_CFLAGS@ -DPACKAGE_DATA_DIR=\"$(pkgdatadir)\"
-electricsheep_preferences_LDFLAGS = @libglade_LIBS@ -export-dynamic
+electricsheep_LDADD = @FFMPEG_LIBS@ -lm -lz
+electricsheep_preferences_LDFLAGS = @GLADE_LIBS@ -export-dynamic
 electricsheep_preferences_SOURCES = electricsheep-preferences.c utils.c
 
 
diff --git a/configure.in b/configure.in
index db735ef..5f5d810 100644
--- a/configure.in
+++ b/configure.in
@@ -2,7 +2,6 @@ dnl $Id: configure.in,v 1.55 2008/05/16 20:16:41 spotspot Exp $
 dnl Process this file with autoconf to produce a configure script.
 
 AC_INIT
-AC_CONFIG_SUBDIRS(ffmpeg)
 AC_CONFIG_SRCDIR([electricsheep.c])
 AC_CONFIG_HEADERS([config.h])
 AM_INIT_AUTOMAKE(electricsheep,"2.7b11")
@@ -23,9 +22,12 @@ AC_CHECK_FUNCS(setproctitle)
 X11_PREFIX=`pkg-config --print-errors --variable=prefix x11`
 X11_SHARE="$X11_PREFIX/share"
 
-PKG_CHECK_MODULES(libglade, libglade-2.0 >= 2.5.0 gtk+-2.0 >= 2.7.0)
-AC_SUBST(libglade_CFLAGS)
-AC_SUBST(libglade_LIBS)
+PKG_CHECK_MODULES([GLADE],  libglade-2.0 >= 2.5.0 gtk+-2.0 >= 2.7.0)
+PKG_CHECK_MODULES([FFMPEG], libavformat libavcodec libavutil)
+AC_SUBST(GLADE_CFLAGS)
+AC_SUBST(GLADE_LIBS)
+AC_SUBST(FFMPEG_CFLAGS)
+AC_SUBST(FFMPEG_LIBS)
 
 AC_SUBST(X11_SHARE)
 AC_CONFIG_FILES([Makefile ])
-- 
1.6.1.2

