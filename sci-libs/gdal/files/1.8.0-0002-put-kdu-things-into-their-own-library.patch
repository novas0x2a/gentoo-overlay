From e6db3251e417df37ea59960bab8372082c83b442 Mon Sep 17 00:00:00 2001
From: Mike Lundy <mike@fluffypenguin.org>
Date: Tue, 25 Jan 2011 14:41:51 -0800
Subject: [PATCH 2/3] put kdu things into their own library

---
 gdal-1.8.0/configure.in             |    4 ++--
 gdal-1.8.0/frmts/jp2kak/GNUmakefile |   14 --------------
 gdal-1.8.0/frmts/jp2kak/jp2kak.lst  |   16 ----------------
 3 files changed, 2 insertions(+), 32 deletions(-)
 delete mode 100644 gdal-1.8.0/frmts/jp2kak/jp2kak.lst

diff --git a/gdal-1.8.0/configure.in b/gdal-1.8.0/configure.in
index 5ffe8a7..2a5054d 100644
--- a/gdal-1.8.0/configure.in
+++ b/gdal-1.8.0/configure.in
@@ -1525,7 +1525,7 @@ if test "$with_kakadu" = "no" -o "$with_kakadu" = "" ; then
 elif test "$with_kakadu" = "yes" ; then
   AC_LANG_PUSH(C++)
   old_LIBS="$LIBS"
-  LIBS="$LIBS -lkdu"
+  LIBS="$LIBS -lkdu -lkdu_apps"
   AC_LINK_IFELSE(
     AC_LANG_PROGRAM(
       [#include "kdu_compressed.h"
@@ -1538,7 +1538,7 @@ elif test "$with_kakadu" = "yes" ; then
     [ HAVE_KAKADU=yes ], [ HAVE_KAKADU=no; LIBS="$old_LIBS" ])
   AC_LANG_POP(C++)
 else
-  LIBS="$LIBS -L$with_kakadu/lib -lkdu"
+  LIBS="$LIBS -L$with_kakadu/lib -lkdu -lkdu_apps"
   for incdir in coresys/common apps/compressed_io apps/support apps/image apps/kdu_compress apps/jp2; do
     EXTRA_INCLUDES="$EXTRA_INCLUDES -I$with_kakadu/$incdir -I$with_kakadu/include/kakadu/$incdir"
   done
diff --git a/gdal-1.8.0/frmts/jp2kak/GNUmakefile b/gdal-1.8.0/frmts/jp2kak/GNUmakefile
index 859ccf1..4a09c0a 100644
--- a/gdal-1.8.0/frmts/jp2kak/GNUmakefile
+++ b/gdal-1.8.0/frmts/jp2kak/GNUmakefile
@@ -1,18 +1,8 @@
 
 include ../../GDALmake.opt
 
-ifneq (($KAKDIR),)
-ifneq ($(HAVE_LIBTOOL),yes)
-include $(GDAL_ROOT)/frmts/jp2kak/jp2kak.lst
-endif
-endif
-
 OBJ	=	jp2kakdataset.o
 
-APPOBJ  = $(KAK_OBJ)
-
-INSTOBJ = $(foreach d,$(APPOBJ),../o/$(notdir $(d)))
-
 #CXXFLAGS :=	$(CXXFLAGS) -DFILEIO_DEBUG
 
 CPPFLAGS	:=	$(GDAL_INCLUDE) -I. $(CPPFLAGS)
@@ -21,11 +11,7 @@ default:	$(OBJ:.o=.$(OBJ_EXT))
 
 clean:
 	rm -f *.o $(O_OBJ)
-	rm -f $(INSTOBJ)
 
 install-obj:	$(O_OBJ:.o=.$(OBJ_EXT))
-ifneq ($(HAVE_LIBTOOL),yes)
-	cp $(APPOBJ) ../o
-endif
 
 $(OBJ) $(O_OBJ):	subfile_source.h
diff --git a/gdal-1.8.0/frmts/jp2kak/jp2kak.lst b/gdal-1.8.0/frmts/jp2kak/jp2kak.lst
deleted file mode 100644
index deb4014..0000000
--- a/gdal-1.8.0/frmts/jp2kak/jp2kak.lst
+++ /dev/null
@@ -1,16 +0,0 @@
-KAK_OBJ = \
-	$(KAKDIR)/apps/make/args.o \
-	$(KAKDIR)/apps/make/image_in.o \
-	$(KAKDIR)/apps/make/image_out.o \
-	$(KAKDIR)/apps/make/jp2.o \
-	$(KAKDIR)/apps/make/mj2.o \
-	$(KAKDIR)/apps/make/palette.o \
-	$(KAKDIR)/apps/make/roi_sources.o \
-	$(KAKDIR)/apps/make/kdu_region_decompressor.o \
-	$(KAKDIR)/apps/make/kdu_stripe_decompressor.o
-
-# The following are just for Kakadu 5.1 or later, comment out if older.
-KAK_OBJ +=	\
-    $(KAKDIR)/apps/make/kdu_tiff.o \
-    $(KAKDIR)/apps/make/jpx.o
-
-- 
1.7.4.rc2

