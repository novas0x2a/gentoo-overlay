From d76244b6bd375e189fa477b2093d417f6b894333 Mon Sep 17 00:00:00 2001
From: Mike Lundy <mike@fluffypenguin.org>
Date: Tue, 25 Jan 2011 14:42:43 -0800
Subject: [PATCH 3/3] fix kakadu includes

---
 gdal-1.8.0/GDALmake.opt.in          |    1 +
 gdal-1.8.0/configure.in             |    6 +++++-
 gdal-1.8.0/frmts/jp2kak/GNUmakefile |    2 +-
 3 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/gdal-1.8.0/GDALmake.opt.in b/gdal-1.8.0/GDALmake.opt.in
index 516655b..598cd4f 100644
--- a/gdal-1.8.0/GDALmake.opt.in
+++ b/gdal-1.8.0/GDALmake.opt.in
@@ -167,6 +167,7 @@ HAVE_SPATIALITE = @HAVE_SPATIALITE@
 # JPEG2000 via Kakadu Support.
 #
 HAVE_KAKADU = @HAVE_KAKADU@
+KAKADU_INCLUDE = @KAKADU_INCLUDE@
 #
 # JPEG-2000 Support via JasPer library.
 #
diff --git a/gdal-1.8.0/configure.in b/gdal-1.8.0/configure.in
index 2a5054d..9e5856e 100644
--- a/gdal-1.8.0/configure.in
+++ b/gdal-1.8.0/configure.in
@@ -1520,6 +1520,9 @@ AC_MSG_CHECKING([for Kakadu JPEG2000 support])
 
 AC_ARG_WITH(kakadu,[  --with-kakadu[=ARG]     Include Kakadu/JPEG2000 support],,)
 
+HAVE_KAKADU=no
+KAKADU_INCLUDE=
+
 if test "$with_kakadu" = "no" -o "$with_kakadu" = "" ; then
   HAVE_KAKADU=no
 elif test "$with_kakadu" = "yes" ; then
@@ -1540,7 +1543,7 @@ elif test "$with_kakadu" = "yes" ; then
 else
   LIBS="$LIBS -L$with_kakadu/lib -lkdu -lkdu_apps"
   for incdir in coresys/common apps/compressed_io apps/support apps/image apps/kdu_compress apps/jp2; do
-    EXTRA_INCLUDES="$EXTRA_INCLUDES -I$with_kakadu/$incdir -I$with_kakadu/include/kakadu/$incdir"
+    KAKADU_INCLUDE="$KAKADU_INCLUDE -I$with_kakadu/$incdir -I$with_kakadu/include/kakadu/$incdir"
   done
   HAVE_KAKADU=yes
 fi
@@ -1550,6 +1553,7 @@ if test "$HAVE_KAKADU" = "yes"; then
   OPT_GDAL_FORMATS="jp2kak jpipkak $OPT_GDAL_FORMATS"
 fi
 AC_SUBST(HAVE_KAKADU,$HAVE_KAKADU)
+AC_SUBST(KAKADU_INCLUDE,$KAKADU_INCLUDE)
 
 dnl ---------------------------------------------------------------------------
 dnl Select MrSID library or disable driver.
diff --git a/gdal-1.8.0/frmts/jp2kak/GNUmakefile b/gdal-1.8.0/frmts/jp2kak/GNUmakefile
index 4a09c0a..8fcf83c 100644
--- a/gdal-1.8.0/frmts/jp2kak/GNUmakefile
+++ b/gdal-1.8.0/frmts/jp2kak/GNUmakefile
@@ -5,7 +5,7 @@ OBJ	=	jp2kakdataset.o
 
 #CXXFLAGS :=	$(CXXFLAGS) -DFILEIO_DEBUG
 
-CPPFLAGS	:=	$(GDAL_INCLUDE) -I. $(CPPFLAGS)
+CPPFLAGS	:=	$(GDAL_INCLUDE) -I. $(CPPFLAGS) $(KAKADU_INCLUDE)
 
 default:	$(OBJ:.o=.$(OBJ_EXT))
 
-- 
1.7.4.rc2

